create database littleMarket;

use littleMarket;

create table tbprodutos(
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    descricao TEXT,
    preco DECIMAL(10,2) NOT NULL,
    estoque INT,
    imagem_url VARCHAR(255)
); 

CREATE TABLE tbpedidos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    data_pedido TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status ENUM('pendente', 'processando', 'concluido', 'cancelado') DEFAULT 'pendente',
    FOREIGN KEY (user_id) REFERENCES tbuser(id)
);

create table tbuser(
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    user_type TINYINT NOT NULL DEFAULT 1 COMMENT '1=Normal, 2=Funcionario',
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE tbitens_pedido (
    id INT PRIMARY KEY AUTO_INCREMENT,
    pedido_id INT NOT NULL,
    produto_id INT NOT NULL,
    quantidade INT NOT NULL,
    preco_unitario DECIMAL(10,2) NOT NULL,
    FOREIGN KEY (pedido_id) REFERENCES tbpedidos(id),
    FOREIGN KEY (produto_id) REFERENCES tbprodutos(id)
);

Ver todos os itens de um pedido
SELECT p.*, ip.quantidade, ip.preco_unitario
FROM tbpedidos ped
JOIN tbitens_pedido ip ON ped.id = ip.pedido_id
JOIN tbprodutos p ON ip.produto_id = p.id
WHERE ped.id = [ID_DO_PEDIDO];
